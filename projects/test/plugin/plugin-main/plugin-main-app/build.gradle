apply from: "../plugin-main-app-no-shadow/build.gradle"

android {
    defaultConfig {
        applicationId "com.tencent.shadow.demo_host"
    }
}

buildscript {
    repositories {
        maven {
            url "http://maven.oa.com/nexus/content/repositories/jcenter"
        }
        maven {
            url "http://maven.oa.com/nexus/content/repositories/google-maven/"
        }
    }

    dependencies {
        classpath 'com.tencent.shadow.core:runtime-debug'
        classpath 'com.tencent.shadow.core:gradle-plugin'
        classpath 'org.javassist:javassist:3.22.0-GA'
    }
}

apply plugin: 'com.tencent.shadow.plugin'


shadow {
    transform {
//        useHostContext = ['abc']
    }

    packagePlugin {
        pluginTypes {
            debug {
                loaderApkConfig = new Tuple2('dynamic-loader-debug.apk', ':dynamic-loader:assembleDebug')
                runtimeApkConfig = new Tuple2('dynamic-runtime-debug.apk', ':dynamic-runtime:assembleDebug')
                pluginApks {
                    pluginApk1 {
                        businessName = 'demo'
                        partKey = 'plugin-main-app'
                        buildTask = ':plugin-main-app:assembleDebug'
                        apkName = 'plugin-main-app-debug.apk'
                        apkPath = 'projects/test/plugin/plugin-main/plugin-main-app/build/outputs/apk/debug/plugin-main-app-debug.apk'
                        hostWhiteList = ["androidx.test.espresso",//这个包添加是为了插件demo中可以访问测试框架的类
                                         "com.tencent.shadow.demo.interfaces"]//测试插件访问宿主白名单类
                    }
                    pluginApk2 {
                        businessName = 'plugin-multidex'
                        partKey = 'plugin-multidex-v1_0_2'
                        buildTask = ':plugin-multidex-v1_0_2:assembleDebug'
                        apkName = 'plugin-multidex-v1_0_2-debug.apk'
                        apkPath = 'projects/test/plugin/plugin-multidex/plugin-multidex-v1_0_2/build/outputs/apk/debug/plugin-multidex-v1_0_2-debug.apk'
                    }
                    pluginApk3 {
                        businessName = 'plugin-multidex'
                        partKey = 'plugin-multidex-v2_0_1'
                        buildTask = ':plugin-multidex-v2_0_1:assembleDebug'
                        apkName = 'plugin-multidex-v2_0_1-debug.apk'
                        apkPath = 'projects/test/plugin/plugin-multidex/plugin-multidex-v2_0_1/build/outputs/apk/debug/plugin-multidex-v2_0_1-debug.apk'
                    }
                }
            }

            release {
                loaderApkConfig = new Tuple2('dynamic-loader-release.apk', ':dynamic-loader:assembleRelease')
                runtimeApkConfig = new Tuple2('dynamic-runtime-release.apk', ':dynamic-runtime:assembleRelease')
                pluginApks {
                    pluginApk1 {
                        businessName = 'demo'
                        partKey = 'plugin-main-app'
                        buildTask = ':plugin-main-app:assembleRelease'
                        apkName = 'plugin-main-app-release.apk'
                        apkPath = 'projects/test/plugin/plugin-main/plugin-main-app/build/outputs/apk/release/plugin-main-app-release.apk'
                        hostWhiteList = ["androidx.test.espresso",//这个包添加是为了插件demo中可以访问测试框架的类
                                         "com.tencent.shadow.demo.interfaces"]//测试插件访问宿主白名单类
                    }
                    pluginApk2 {
                        businessName = 'plugin-multidex'
                        partKey = 'plugin-multidex-v1_0_2'
                        buildTask = ':plugin-multidex-v1_0_2:assembleRelease'
                        apkName = 'plugin-multidex-v1_0_2-release.apk'
                        apkPath = 'projects/test/plugin/plugin-multidex/plugin-multidex-v1_0_2/build/outputs/apk/release/plugin-multidex-v1_0_2-release-unsigned.apk'
                    }
                    pluginApk3 {
                        businessName = 'plugin-multidex'
                        partKey = 'plugin-multidex-v2_0_1'
                        buildTask = ':plugin-multidex-v2_0_1:assembleRelease'
                        apkName = 'plugin-multidex-v2_0_1-release.apk'
                        apkPath = 'projects/test/plugin/plugin-multidex/plugin-multidex-v2_0_1/build/outputs/apk/release/plugin-multidex-v2_0_1-release-unsigned.apk'
                    }
                }
            }
        }

        loaderApkProjectPath = 'projects/test/host/dynamic/dynamic-loader'

        runtimeApkProjectPath = 'projects/test/host/dynamic/dynamic-runtime'

        version = 4
        compactVersion = [1, 2, 3]
        uuidNickName = "1.1.5"
    }
}